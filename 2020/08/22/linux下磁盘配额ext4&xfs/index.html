<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>RHEL/CENTOS磁盘配额 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="环境：vmware workstation 15 redhat 7.6&#x2F;centos 7.6 使用情景：配额是面向用户进行的磁盘空间管理工作，其目的是为了限制用户过多的使用磁盘资源，造成浪费，降低空间利用率 一、ext4文件系统的配额方法1.添加硬盘     在vmware workstation 的图形化界面中用鼠标添加一块新硬盘     重启，系统重新读盘  2.分区      fdisk &#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="RHEL&#x2F;CENTOS磁盘配额">
<meta property="og:url" content="http://yoursite.com/2020/08/22/linux%E4%B8%8B%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9Dext4&xfs/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="环境：vmware workstation 15 redhat 7.6&#x2F;centos 7.6 使用情景：配额是面向用户进行的磁盘空间管理工作，其目的是为了限制用户过多的使用磁盘资源，造成浪费，降低空间利用率 一、ext4文件系统的配额方法1.添加硬盘     在vmware workstation 的图形化界面中用鼠标添加一块新硬盘     重启，系统重新读盘  2.分区      fdisk &#x2F;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-08-21T17:53:22.403Z">
<meta property="article:modified_time" content="2019-06-20T08:32:54.099Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="linux&#x2F;storage">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-linux下磁盘配额ext4&amp;xfs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/22/linux%E4%B8%8B%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9Dext4&xfs/" class="article-date">
  <time datetime="2020-08-21T17:53:22.403Z" itemprop="datePublished">2020-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RHEL/CENTOS磁盘配额
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h3><pre><code>vmware workstation 15
redhat 7.6/centos 7.6</code></pre>
<h3 id="使用情景："><a href="#使用情景：" class="headerlink" title="使用情景："></a>使用情景：</h3><pre><code>配额是面向用户进行的磁盘空间管理工作，其目的是为了限制用户过多的使用磁盘资源，造成浪费，降低空间利用率</code></pre>
<h3 id="一、ext4文件系统的配额方法"><a href="#一、ext4文件系统的配额方法" class="headerlink" title="一、ext4文件系统的配额方法"></a>一、ext4文件系统的配额方法</h3><pre><code>1.添加硬盘
    在vmware workstation 的图形化界面中用鼠标添加一块新硬盘
    重启，系统重新读盘
 2.分区 
    fdisk /dev/sdb    /*我这是第一次添加一个硬盘，所以编号为sdb*/
    Command (m for help): /*输入操作选项 新建分区输入n*/
    Command action
       a   toggle a bootable flag   设定硬盘启动区
       b   edit bsd disklabel
       c   toggle the dos compatibility flag
       d   delete a partition        删除一个分区
       g   create a new empty GPT partition table
       G   create an IRIX (SGI) partition table
       l   list known partition types  列出已知的分区类型，不常用的分区类型可以在这里找到
       m   print this menu                                显示所有的列表
       n   add a new partition                            新建一个分区
       o   create a new empty DOS partition table   创建一个新的dos分区表
       p   print the partition table               输出分区表
       q   quit without saving changes      退出不保存
       s   create a new empty Sun disklabel
       t   change a partition&#39;s system id   更改分区类型
       u   change display/entry units
       v   verify the partition table        
       w   write table to disk and exit 写入分区表，保存操作
       x   extra functionality (experts only)


        Partition type:
           p   primary (1 primary, 0 extended, 3 free)        主分区
           e   extended                                        扩展分区、
        Select (default p):                                 这里输入p

        Partition number (1-4, default 1):                     这里是分区编号，默认即可

        First sector (2048-41943039, default 2048):         起始扇区，没有特殊要求默认即可

        Using default value 2048                            从2048扇区开始
        Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039):     结束扇区，可以+&#123;K,M,G&#125;
        Partition 1 of type Linux and of size 2 GiB is set    分区1，类型为linux主分区，大小是2G

        分区创建成功！！

3.格式化 
    注意：所有的分区，逻辑卷，阵列，如果不进行格式化都不能进行挂载使用
    mkfs.[type]+目录
    例：mkfs.xfs /dev/sdb/sdb1
4.挂载
    注意：所有的分区，逻辑卷，阵列，如果不进行挂载就不能进行使用 
    临时挂载：
        mount  [目录] [挂载目录]
        例：mount /dev/sdb/sdb1 /mnt
    永久性挂载：
        vim /etc/fstab    
        内容：
        添加一行：/dev/sdb/sdb1      /mnt/        iso9660        xfs        defaults  0 0

5.更改权限
     chmod 777 /mnt/            权限给到最大方便测试
6.文件创建与扫描
     quotacheck /mnt/
7.激活配额点
     quotaon  /mnt/
8.对用户进行配额操作
     edquota alex
     编辑内容：
        Disk quotas for user alex (uid 1001):
          Filesystem                   blocks       soft       hard     inodes     soft     hard
          /dev/sdb1                       352        300        400          1        0        0
     参数详解：
        blocks     块大小限制
        inodes    文件个数限制
        soft    软限制    
        hard    硬限制

9.验证
    dd if=/dev/zero of=/mnt/1.test    bs=1k  count=401
    提示：
        [alex@localhost mnt]$ dd if=/dev/zero of=/mnt/1.test bs=1k count=401  测试写入401k
        sdb1: warning, user block quota exceeded.
        sdb1: write failed, user block limit reached.
        dd: error writing ‘/mnt/1.test’: Disk quota exceeded    错误，超限,证明硬限制生效
        401+0 records in
        400+0 records out
        409600 bytes (410 kB) copied, 0.00162328 s, 252 MB/s</code></pre>
<h3 id="二、xfs文件系统的磁盘配额"><a href="#二、xfs文件系统的磁盘配额" class="headerlink" title="二、xfs文件系统的磁盘配额"></a>二、xfs文件系统的磁盘配额</h3><pre><code> 1.添加硬盘 
    在vmware workstation    图形化界面中用鼠标添加一块新硬盘

 2.分区
    对新添加的硬盘进行分区
    fdisk /dev/sdb   选择新添加的硬盘进行分区操作
    Command (m for help):             这里输入进行分区的操作，我们输入n,添加一个新分区 
    Partition type:                    分区类型
       p   primary (0 primary, 0 extended, 4 free) 主分区
        e   extended                                     扩展分区
    Select (default p):             这里我们输入p,默认输入p
    Partition number (1-4, default 1):这里是分区编号，默认为1，最多只能创建4个主分区
    First sector (2048-41943039, default 2048):       这里是起始扇区，如果没有特殊要求默认即可
Using default value 2048
    Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039): 这里是结束扇区，可+&#123;K,M,G&#125;，根据需要输入
    Partition 1 of type Linux and of size 2 GiB is set     分区1，类型为linux主分区，大小为2G
    Command (m for help): p      输出所有的分区
    Command (m for help): w   最后输入w保存退出

 3.格式化
    注意：所有的设备，分区，阵列，逻辑卷，只有在格式化之后才可以被挂载
    mkfs.xfs /dev/sdb1
    lsblk -f            可查看是否格式化成功
 4.挂载
    注意:所有的设备，分区，阵列，逻辑卷，只有在挂载后才能正常使用
    临时挂载：
        mount /dev/sdb1  /mnt/sdb   将dev下的设备sdb1挂载到/mnt/sdb
    永久挂载
        vim /etc/fstab   编辑挂载表文件
        内容:
        添加一行: 
            /dev/sdb1  /mnt/sdb  xfs   defaults,usrquota      0 0
        mount -a 重读分区表
        mount 查看挂载是否成功
        /dev/sdb1 on /mnt/sdb type xfs (rw,relatime,seclabel,attr2,inode64,usrquota)   确保挂载选项有usrquota

  5.更改权限
    chmod 777 /mnt/sdb  将权限开到最大，方便测试，在实际环境中，只要保证配额用户有写入权限
  6.设置配额
    xfs_quota -x -c &quot;limit bsoft=300k bhard=400k alex&quot; /mnt/sdb
    注意：这里配置成功是没有提示的，需要用户自行测试
  7.测试
    切换用户alex
    su - alex

    测试1写入425k 
    dd if=/dev/zero of=/mnt/sdb/1.txt bs=1k count=425
    dd: error writing ‘/mnt/sdb/1.txt’: Disk quota exceeded
    401+0 records in
    400+0 records out
    409600 bytes (410 kB) copied, 0.00254558 s, 161 MB/s

    最终成功写入400k，证明硬限制400K生效
    total 400K
    -rw-rw-r--. 1 alex alex 400K Jun 12 07:16 1.txt

    测试2写入350k
    如果已经做了测试1，要把测试1生成的1.txt删除
        rm -rf 1.txt

    dd if=/dev/zero of=/mnt/sdb/2.txt bs=1k count=350   测试写入350k
    350+0 records in
    350+0 records out
    358400 bytes (358 kB) copied, 0.00110362 s, 325 MB/s

    ll -h 
    /mnt/total 352K
    -rw-rw-r--. 1 alex alex 350K Jun 12 07:23 2.txt   成功写入350k，但是没有报警，软限制没有生效</code></pre>
<h3 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h3><pre><code>1.两种文件系统的配额方法不一样
2.ext4文件系统的步骤为：
 准备：分区，格式化，挂载
 文件创建扫描
 激活配额挂载点
 编辑配额文件
 写入测试
3.xfs文件系统的步骤为：
 准备：分区，格式化，挂载
 设置配额
 写入文件测试
4.分区，阵列，逻辑卷都可以做配额
5.针对用户做配额，在挂载选项里写defaults,usrquota,用mount查看挂载usrquota功能是否成功
6.针对组做配额也可以，步骤大同小异
7.学习linux，一定要有自学能力，如果你认为自己的自学能力很强，那请你再加强，如果你认为自学能力不强，那就赶紧培养，linux老师，是教不完的，是学不完的，学无止境</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/22/linux%E4%B8%8B%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9Dext4&xfs/" data-id="cke4j8nnf000ej4t9cdqq0upp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux-storage/" rel="tag">linux/storage</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/22/linux%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BA/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          linux交换分区管理
        
      </div>
    </a>
  
  
    <a href="/2020/08/22/ISCSI%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E6%90%AD%E5%BB%BA/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ISCS服务器基本搭建</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/internet/" rel="tag">internet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-network/" rel="tag">linux/network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-network-storage/" rel="tag">linux/network storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-server/" rel="tag">linux/server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-storage/" rel="tag">linux/storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-user/" rel="tag">linux/user</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/internet/" style="font-size: 13.33px;">internet</a> <a href="/tags/linux-network/" style="font-size: 10px;">linux/network</a> <a href="/tags/linux-network-storage/" style="font-size: 10px;">linux/network storage</a> <a href="/tags/linux-server/" style="font-size: 20px;">linux/server</a> <a href="/tags/linux-storage/" style="font-size: 16.67px;">linux/storage</a> <a href="/tags/linux-user/" style="font-size: 10px;">linux/user</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/22/%E7%BD%91%E5%8D%A1%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/">网卡链路聚合</a>
          </li>
        
          <li>
            <a href="/2020/08/22/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">交换机的工作原理</a>
          </li>
        
          <li>
            <a href="/2020/08/22/%E7%A3%81%E7%9B%98%E7%9A%84%E6%8C%82%E8%BD%BD%E4%B8%8E%E4%BD%BF%E7%94%A8/">linux下设备的挂载与使用</a>
          </li>
        
          <li>
            <a href="/2020/08/22/windows%E5%B9%B3%E5%8F%B0%E4%B8%8B%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/">windows下设置文件共享</a>
          </li>
        
          <li>
            <a href="/2020/08/22/VLAN%E6%8A%80%E6%9C%AF%E7%9A%84%E5%8E%9F%E7%90%86/">VLAN技术的原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>